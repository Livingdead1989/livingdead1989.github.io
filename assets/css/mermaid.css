/* =========================================================
   Mermaid
   Relies on mermaid.js themeVariables for color
   ========================================================= */

/* =========================================================
   Container & Layout
   ========================================================= */

.mermaid {
  margin: 2.5rem 0 1.5rem;
  padding: 1.25rem;
  overflow-x: auto;
  display: flex;
  justify-content: center;
  align-items: center;

  /* motion-safe defaults */
  opacity: 1;
  transform: none;
}

/* SVG sizing & rendering quality */
.mermaid svg {
  width: 100%;
  max-width: 100%;
  height: auto;
  font-family: var(--font-sans);
  shape-rendering: geometricPrecision;
  text-rendering: optimizeLegibility;
}

/* Optional caption below diagram */
.mermaid-caption {
  margin-top: 0.5rem;
  font-size: 0.875rem;
  color: var(--text-muted);
  text-align: center;
}

/* =========================================================
   Text Clarity (Critical)
   ========================================================= */

/* Kill SVG stroke inheritance on text */
.mermaid text,
.mermaid tspan {
    stroke: none !important;
    stroke-width: 0 !important;
    filter: none !important;
    text-shadow: none !important;
    paint-order: fill !important;
    vector-effect: non-scaling-stroke;
    font-family: var(--font-sans);
}
.mermaid tspan {
  fill: var(--diagram-text-on-surface);
}

/* Disable filters Mermaid sometimes injects */
.mermaid text {
  filter: none !important;
  text-shadow: none !important;
}

/* Edge labels & annotations */
.mermaid .edgeLabel text,
.mermaid .messageText,
.mermaid .note text,
.mermaid .legend text,
.mermaid .pieTitleText {
  stroke: none !important;
}

/* =========================================================
   Nodes (Flowcharts, Mindmaps, States)
   ========================================================= */

.mermaid .node rect,
.mermaid .node polygon,
.mermaid .node ellipse,
.mermaid .mindmap-node > rect,
.mermaid .mindmap-node > path {
  stroke-width: 1;
  rx: 6;
  ry: 6;
}

.mermaid .mindmap-node text,
.mermaid .timeline-item text {
  fill: var(--diagram-text-on-surface) !important;
}

.mermaid .node text,
.mermaid .mindmap-node text {
  font-size: 13px;
  font-weight: 500;
}

/* Root emphasis (mindmap) */
.mermaid .mindmap-root > rect {
  stroke-width: 2;
}

/* =========================================================
   Edges / Links
   ========================================================= */

.mermaid .edgePath path,
.mermaid .mindmap-edge {
  stroke-width: 1.5;
}

.mermaid marker path {
  stroke: none;
}

.mermaid .edgeLabel text,
.mermaid .note text {
  fill: var(--diagram-text-on-surface) !important;
}

.mermaid .pieTitleText,
.mermaid .cluster text {
  fill: var(--text) !important;
}

/* =========================================================
   Sequence Diagrams
   ========================================================= */

.mermaid .actor rect {
  rx: 6;
  ry: 6;
}

.mermaid .actor text {
  font-weight: 600;
}

.mermaid .messageLine0,
.mermaid .messageLine1 {
  stroke-width: 2;
}

.mermaid .note rect {
  rx: 6;
  ry: 6;
  stroke-width: 1;
}

.mermaid .activation0,
.mermaid .activation1,
.mermaid .activation2 {
  stroke-width: 1;
}

/* =========================================================
   Pie Charts
   ========================================================= */

.mermaid .pieOuterCircle {
  fill: none;
}

.mermaid .pieCircle {
  opacity: 0.95;
  transition: transform 200ms cubic-bezier(0.65, 0.5, 0.36, 1);
}

/* Hover effect */
.mermaid .pieCircle:hover {
  transform: scale(1.03);
}

.mermaid .slice {
  font-weight: 600;
  font-size: 13px;
}

.mermaid .legend rect {
  rx: 3;
  ry: 3;
}

/* =========================================================
   Timelines
   ========================================================= */

.mermaid .timeline-line {
  stroke-width: 2;
}

.mermaid .timeline-item rect {
  rx: 6;
  ry: 6;
}

.mermaid .timeline-item text {
  font-size: 13px;
  fill: var(--diagram-text-on-surface) !important;
}

/* =========================================================
   Subgraphs / Clusters
   ========================================================= */

.mermaid .cluster rect {
  stroke-dasharray: 4 3;
  rx: 8;
  ry: 8;
}

.mermaid .cluster text {
  font-weight: 600;
}

/* =========================================================
   Motion-safe render transitions
   ========================================================= */

@media (prefers-reduced-motion: no-preference) {
  .mermaid {
    transition:
      opacity 360ms var(--motion-ease),
      transform 360ms var(--motion-ease);
  }

  .mermaid.is-rendering {
    opacity: 0;
    transform: translateY(6px);
  }
}

@media (prefers-reduced-motion: reduce) {
  .mermaid {
    transition: none;
    animation: none;
  }
}

/* =========================================================
   Print Safety
   ========================================================= */

@media print {
  .mermaid {
    background: #ffffff;
    box-shadow: none;
  }

  .mermaid svg {
    filter: none;
  }

  .mermaid text {
    fill: #000 !important;
  }

  .mermaid .edgePath path,
  .mermaid .timeline-line {
    stroke: #000 !important;
  }
}

/* =========================================================
   Mobile Adjustments
   ========================================================= */

@media (max-width: 768px) {
  .mermaid {
    padding: 0;
    display: block; 
  }
  .mermaid svg {
    display: block;
    margin: 0 auto;
  }
}

/* =========================================================
   Reduced Motion
   ========================================================= */

@media (prefers-reduced-motion: reduce) {
  .mermaid .pieCircle path {
    transition: none;
  }

  .mermaid .pieCircle:hover  {
    transform: none;
  }
}